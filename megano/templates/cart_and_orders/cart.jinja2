{% extends 'base.jinja2' %}
{% block title %}
    –ö–æ—Ä–∑–∏–Ω–∞
{% endblock %}

{% block content %}
    <div class="Middle Middle_top">
        <div class="Section">
            <div class="wrap">
                <h1>–ö–æ—Ä–∑–∏–Ω–∞ —Ç–æ–≤–∞—Ä–æ–≤</h1>
                <div class="Cart-products">
                    {% if cart_items %}
                        {% for item in cart_items %}
                            <form class="form Cart"
                                  action="{{ url('cart_and_orders:change_cart_quantity', product_id=item.product_seller.id) }}"
                                  method="post">
                                {% csrf_token %}
                                <div class="Cart-product">
                                    <div class="Cart-block Cart-block_row">
                                        <div class="Cart-block Cart-block_pict">
                                            <a class="Cart-pict"
                                               href="{{ url('shopapp:product_detail', product_slug=item.product_seller.product.slug) }}"><img
                                                    class="Cart-img"
                                                    src="{{ item.product_seller.product.image.url }}"
                                                    alt="{{ item.product_seller.product.name }}"></a>
                                        </div>
                                        <div class="Cart-block Cart-block_info">
                                            <a class="Cart-title"
                                               href="{{ url('shopapp:product_detail', product_slug=item.product_seller.product.slug) }}">{{ item.product_seller.product.name }}</a>
                                            <div class="Cart-desc">{{ item.product_seller.product.description }}</div>
                                        </div>
                                        <div class="Cart-block Cart-block_price">
                                            <div class="Cart-price">
                                                ${{ item.product_seller.price * item.quantity }}</div>
                                        </div>
                                    </div>
                                    <div class="Cart-block Cart-block_row">
                                        <div class="Cart-block Cart-block_seller">
                                            <!-- Seller info -->
                                        </div>
                                        <div class="Cart-block Cart-block_amount">
                                            <div class="Cart-amount">
                                                <div class="Amount">
                                                    <button class="Amount-remove" type="submit"></button>
                                                    <input class="Amount-input form-input" name="order_quantity"
                                                           type="text" max="{{ item.product_seller.quantity }}"
                                                           value="{{ item.quantity }}">
                                                    <button class="Amount-add" type="submit"></button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="Cart-block Cart-block_delete">
                                            <div class="Cart-block Cart-block_delete"><input class="Cart-update" type="submit" value="–û–±–Ω–æ–≤–∏—Ç—å —Ç–æ–≤–∞—Ä"></div>
                                            <a class="Cart-delete"
                                               href="{{ url('cart_and_orders:remove_from_cart', product_id=item.product_seller.id) }}"><img
                                                    src="{{ static('assets/img/icons/card/delete.svg') }}"
                                                    alt="–£–¥–∞–ª–∏—Ç—å –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã"></a>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        {% endfor %}
                    {% else %}
                        <h2> –¢–æ–≤–∞—Ä—ã –µ—â–µ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ –∫–æ—Ä–∑–∏–Ω—É</h2>
                        <p class="Card-title">–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –Ω–∞ <a style="color:#1e7cc4" href="/">–≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ</a>,
                            –≤–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å <a style="color:#1e7cc4" href="/catalog">–∫–∞—Ç–∞–ª–æ–≥–æ–º</a> –∏–ª–∏ –ø–æ–∏—Å–∫–æ–º</p>
                    {% endif %}
                </div>
                <div class="Cart-total">
                    <div class="Cart-block Cart-block_total">
                        <strong class="Cart-title">–ò—Ç–æ–≥–æ:</strong>
                        <span class="Cart-price">${{ total_price }}</span>
                    </div>
                    {% if price_with_discount %}
                    <div class="Cart-block Cart-block_total">
                        <strong class="Cart-title">–¶–µ–Ω–∞ —Å–æ —Å–∫–∏–¥–∫–æ–π:</strong>
                        <span class="Cart-price" style="color: #3cb878;">${{ price_with_discount }}</span>
                    </div>
                    {% endif %}
                    <div class="Cart-block">
                        {% if cart_items %}
                            <a class="btn btn_success btn_lg" style="margin-right: 20px; margin-bottom: 20px" href="{{ url('cart_and_orders:order') }}">–û—Ñ–æ—Ä–º–∏—Ç—å
                                –∑–∞–∫–∞–∑</a>
                            <a class="btn btn_success btn_lg" style="margin-right: 20px; margin-bottom: 20px"  href="{{ url('cart_and_orders:clear_cart') }}">–û—á–∏—Å—Ç–∏—Ç—å
                                –∫–æ—Ä–∑–∏–Ω—É</a>
                        {% endif %}
                    </div>
                </div>
{#====================================================================================================================#}
                <div class="Comments" id="comments-section">
                {% if discounts %}
                    <span class="Cart-title" style="margin-bottom: 25px;">–ü—Ä–∏–º–µ–Ω–µ–Ω–∞ —Å–∫–∏–¥–∫–∞:</span>
                {% for discount in discounts %}
                    <div class="Comment" style="margin-bottom: 20px">
                        <div class="Comment-column Comment-column_pict">
                            <div class="Comment-avatar" style="background-image: url('../static/assets/img/icons/card/discount.svg')"></div>
                        </div>
                        <div class="Comment-column">
                            <header class="Comment-header">
                                <div>
                                    <strong class="Comment-title">{{ discount.title }}</strong>
                                    <span class="Comment-date">
                                        {% if discount.start and discount.end %}
                                            –°–∫–∏–¥–∫–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞ —Å {{ discount.start.strftime('%d-%m-%Y') }} –ø–æ {{ discount.end.strftime('%d-%m-%Y') }}
                                        {% endif %}
                                        {% if discount.start and not discount.end %}
                                            –°–∫–∏–¥–∫–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞ —Å {{ discount.start.strftime('%d-%m-%Y') }}
                                        {% endif %}
                                        {% if not discount.start and discount.end %}
                                            –°–∫–∏–¥–∫–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞ –ø–æ {{ discount.end.strftime('%d-%m-%Y') }}
                                        {% endif %}
                                    </span>
                                </div>
                            </header>
                            <div class="Comment-content">
                                <span class="Comment-date">{{ discount.description }}</span>
                                {% if discount.type == "c" %}
                                    <div>–°–∫–∏–¥–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ –Ω–∞ –∫–æ—Ä–∑–∏–Ω—É</div>
                                    {% if discount.cart_numbers %}
                                        <div>–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª-–≤–æ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∫–æ—Ä–∑–∏–Ω–µ –¥–ª—è —Å–∫–∏–¥–∫–∏: {{ discount.cart_numbers }} —à—Ç</div>
                                    {% endif %}
                                    {% if discount.cart_price %}
                                        <div>–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∫–æ—Ä–∑–∏–Ω–µ –¥–ª—è —Å–∫–∏–¥–∫–∏: ${{ discount.cart_price }}</div>
                                    {% endif %}
                                {% endif %}
                                {% if discount.type == "s" %}
                                    <div>–°–∫–∏–¥–∫–∞ –ø—Ä–∏–º–µ–Ω–∞ –Ω–∞ –Ω–∞–±–æ—Ä —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∫–æ—Ä–∑–∏–Ω–µ</div>
                                    {% if discount.products.all() %}
                                        <div>–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–π –Ω–∞–±–æ—Ä –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –≤ –∫–æ—Ä–∑–∏–Ω–µ –¥–ª—è —Å–∫–∏–¥–∫–∏:
                                        {% for product in discount.products.all() %}
                                            {{ product }}{{ ", " if not loop.last else "." }}
                                        {% endfor %}
                                        </div>
                                    {% endif %}
                                    {% if discount.categories.all() %}
                                        <div>–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–π –Ω–∞–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∫–æ—Ä–∑–∏–Ω–µ –¥–ª—è —Å–∫–∏–¥–∫–∏:
                                        {% for category in discount.categories.all() %}
                                             {{ category }}{{ ", " if not loop.last else "." }}
                                        {% endfor %}
                                        </div>
                                    {% endif %}
                                {% endif %}
                                {% if discount.type == "p" %}
                                    <div>–°–∫–∏–¥–∫–∞ –ø—Ä–∏–º–µ–Ω–∞ –Ω–∞ —Ç–æ–≤–∞—Ä—ã –≤ –∫–æ—Ä–∑–∏–Ω–µ</div>
                                {% if discount.products.all() %}
                                    <div>–°–∫–∏–¥–∫–∞ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–µ –ø—Ä–æ–¥—É–∫—Ç—ã:
                                    {% for product in discount.products.all() %}
                                        {{ product }}{{ ", " if not loop.last else "." }}
                                    {% endfor %}
                                    </div>
                                {% endif %}
                                {% if discount.categories.all() %}
                                    <div>–°–∫–∏–¥–∫–∞ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤:
                                    {% for category in discount.categories.all() %}
                                         {{ category }}{{ ", " if not loop.last else "." }}
                                    {% endfor %}
                                    </div>
                                {% endif %}
                                {% endif %}
                                {% if discount.percent %}
                                    <div>–†–∞–∑–º–µ—Ä —Å–∫–∏–¥–∫–∏: {{ discount.percent }}%</div>
                                {% endif %}
                                {% if discount.discount_volume %}
                                    <div>–†–∞–∑–º–µ—Ä —Å–∫–∏–¥–∫–∏: ${{ discount.discount_volume }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                    <a href="{{ url('shopapp:discounts') }}"><span class="menu-label menu-label_success">–í—Å–µ —Å–∫–∏–¥–∫–∏ –º–∞–≥–∞–∑–∏–Ω–∞...üëâüèΩ</span></a>
                {% endif %}
            </div>
{#====================================================================================================================#}
            </div>
        </div>
    </div>
{% endblock %}
<script>
    document.querySelector('input[type=checkbox]').addEventListener('change', function () {
    // –°–∏–º—É–ª–∏—Ä—É–µ–º –∫–ª–∏–∫ –Ω–∞ –∫–Ω–æ–ø–∫–µ "–Ω–∞–π—Ç–∏"
    document.querySelector('#findButton').click();
});
</script>
